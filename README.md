# Сайт для телеграм-канала «тесные киски»

Канал https://t.me/tightpussies

Сайт https://tightpussies.ru/

## Запуск

```bash
# Установка зависимостей
npm install

# Запуск dev-сервера
npm run dev

# Сборка для продакшена
npm run build

# Превью продакшен-сборки
npm run preview
```

## Добавление новых изображений

1. Положи изображения в `public/images/` с именами `cat-1.jpg`, `cat-2.jpg`, и т.д.
2. Запусти генерацию манифеста:
   ```bash
   npm run generate-manifest
   ```
   Это создаст `src/data/images.json` с размерами и aspect ratio всех изображений.
3. Запусти оптимизацию изображений:
   ```bash
   npm run optimize-images
   ```
   Это создаст WebP-миниатюры в `public/images/thumbs/` для галереи (250w и 500w для retina).

### Оптимизация изображений

Галерея использует оптимизированные WebP-миниатюры для быстрой загрузки:
- `public/images/thumbs/{id}-250w.webp` — для обычных экранов (1x)
- `public/images/thumbs/{id}-500w.webp` — для retina-экранов (2x)

Оригиналы в `public/images/` используются только в лайтбоксе при клике на изображение.

## Архитектура

- **React + TypeScript + Vite** — основной стек

### Как работает бесконечный canvas

1. **Глобальный layout** (`src/lib/globalLayout.ts`):
   - Создаётся виртуальный мир 12000x12000 пикселей
   - Изображения раскладываются в justified rows (как в Google Photos)
   - Каждый ряд заполняет всю ширину мира
   - Мир зацикливается — при скролле за границу появляется начало

2. **Виртуализация**:
   - Рендерятся только видимые изображения
   - Spatial index для быстрого поиска видимых изображений
   - При панорамировании мир "повторяется" бесконечно

3. **Drag с инерцией** (`src/components/Canvas/Canvas.tsx`):
   - Pointer events для drag
   - Decay-анимация для momentum после отпускания
   - Эффект "массы" — canvas стартует медленно и разгоняется

## Структура проекта

```
src/
├── components/
│   ├── Canvas/        # Основной canvas с drag-логикой
│   ├── Lightbox/      # Модалка для просмотра фото
│   └── InfoButton/    # Кнопка с информацией
├── lib/
│   └── globalLayout.ts  # Алгоритм раскладки изображений
├── data/
│   └── images.json    # Манифест изображений (генерируется)
└── types.ts           # TypeScript типы
```
